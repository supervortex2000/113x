From c350ebc109146dd9e9d14d83dda37adce64d7412 Mon Sep 17 00:00:00 2001
From: Arun P Madhavan <arun_madhavan@comcast.com>
Date: Tue, 26 May 2020 13:20:43 +0000
Subject: [PATCH 1/2] cmake-plugin-fixes

---
 cmake/FindWaylandEGL.cmake     |  2 +-
 cmake/FindWesterosClient.cmake | 26 ++++++++++++++------------
 cmake/FindWesterosServer.cmake | 27 +++++++++++++++------------
 3 files changed, 30 insertions(+), 25 deletions(-)

diff --git a/cmake/FindWaylandEGL.cmake b/cmake/FindWaylandEGL.cmake
index eab9f03..f2fd99f 100644
--- a/cmake/FindWaylandEGL.cmake
+++ b/cmake/FindWaylandEGL.cmake
@@ -32,7 +32,7 @@
 find_package(PkgConfig)
 pkg_check_modules(WAYLAND_EGL wayland-egl)
 
-find_library(WAYLAND_EGL_LIB NAMES wayland-egl
+find_library(WAYLAND_EGL_LIB NAMES Mali
         HINTS ${WAYLAND_EGL_LIBDIR} ${WAYLAND_EGL_LIBRARY_DIRS})
 
 if(WAYLAND_EGL_FOUND AND NOT TARGET WaylandEGL::WaylandEGL)
diff --git a/cmake/FindWesterosClient.cmake b/cmake/FindWesterosClient.cmake
index 03d5905..012282b 100644
--- a/cmake/FindWesterosClient.cmake
+++ b/cmake/FindWesterosClient.cmake
@@ -44,25 +44,27 @@ find_library(WESTEROS_CLIENT_LIB_SHELL_CLIENT NAMES westeros_simpleshell_client
         HINTS ${PC_WESTEROS_LIBDIR} ${PC_WESTEROS_LIBRARY_DIRS}
         )
 
+find_library(WESTEROS_CLIENT_LIB_SOC NAMES westeros_gl
+        HINTS ${PC_WESTEROS_LIBDIR} ${PC_WESTEROS_LIBRARY_DIRS}
+        )
+
 find_path(WESTEROS_CLIENT_INCLUDE_DIRS NAMES westeros-compositor.h
         HINTS ${PC_WESTEROS_INCLUDEDIR} ${PC_WESTEROS_INCLUDE_DIRS}
         )
 
-set (WESTEROS_CLIENT_LIBRARIES ${PC_WESTEROS_LIBRARIES} "${WESTEROS_CLIENT_LIB_SERVER}" "${WESTEROS_CLIENT_LIB_SERVER}" "${WESTEROS_CLIENT_LIB_CLIENT}" "${WESTEROS_CLIENT_LIB_CLIENT}")
+set (WESTEROS_CLIENT_LIBRARIES ${PC_WESTEROS_LIBRARIES} "${WESTEROS_CLIENT_LIB_SERVER}" "${WESTEROS_CLIENT_LIB_SERVER}" "${WESTEROS_CLIENT_LIB_CLIENT}" "${WESTEROS_CLIENT_LIB_CLIENT}" "${WESTEROS_CLIENT_LIB_SOC}")
 
 set (WESTEROS_CLIENT_FOUND ${PC_WESTEROS_FOUND})
 
-if(WESTEROS_CLIENT_FOUND AND NOT TARGET WesterosClient::WesterosClient)
-    set(WESTEROS_CLIENT_LIB_CLIENT_LINK_LIBRARIES "${WESTEROS_CLIENT_LIB}" "${WESTEROS_CLIENT_LIB_SHELL_CLIENT}" "${WESTEROS_CLIENT_LIB_BUFFER_CLIENT}")
-    add_library(WesterosClient::WesterosClient UNKNOWN IMPORTED)
-    set_target_properties(WesterosClient::WesterosClient PROPERTIES
-            IMPORTED_LINK_INTERFACE_LANGUAGES "C"
-            IMPORTED_LOCATION "${WESTEROS_CLIENT_LIB}"
-            INTERFACE_INCLUDE_DIRECTORIES "${WESTEROS_CLIENT_INCLUDE_DIRS}"
-            INTERFACE_COMPILE_OPTIONS "${WESTEROS_CLIENT_CFLAGS_OTHER}"
-            INTERFACE_LINK_LIBRARIES "${WESTEROS_CLIENT_LIB_CLIENT_LINK_LIBRARIES}"
-            )
-endif()
+set(WESTEROS_CLIENT_LIB_CLIENT_LINK_LIBRARIES "${WESTEROS_CLIENT_LIB}" "${WESTEROS_CLIENT_LIB_SHELL_CLIENT}" "${WESTEROS_CLIENT_LIB_BUFFER_CLIENT}" "${WESTEROS_CLIENT_LIB_SOC}" )
+add_library(WesterosClient::WesterosClient UNKNOWN IMPORTED)
+set_target_properties(WesterosClient::WesterosClient PROPERTIES
+        IMPORTED_LINK_INTERFACE_LANGUAGES "C"
+        IMPORTED_LOCATION "${WESTEROS_CLIENT_LIB}"
+        INTERFACE_INCLUDE_DIRECTORIES "${WESTEROS_CLIENT_INCLUDE_DIRS}"
+        INTERFACE_COMPILE_OPTIONS "${WESTEROS_CLIENT_CFLAGS_OTHER}"
+        INTERFACE_LINK_LIBRARIES "${WESTEROS_CLIENT_LIB_CLIENT_LINK_LIBRARIES}"
+        )
 
 include(FindPackageHandleStandardArgs)
 FIND_PACKAGE_HANDLE_STANDARD_ARGS(PC_WESTEROS DEFAULT_MSG WESTEROS_CLIENT_FOUND)
diff --git a/cmake/FindWesterosServer.cmake b/cmake/FindWesterosServer.cmake
index 56e63d1..feb52d4 100644
--- a/cmake/FindWesterosServer.cmake
+++ b/cmake/FindWesterosServer.cmake
@@ -48,28 +48,31 @@ find_library(WESTEROS_SERVER_LIB_SHELL_SERVER NAMES westeros_simpleshell_server
         HINTS ${PC_WESTEROS_LIBDIR} ${PC_WESTEROS_LIBRARY_DIRS}
         )
 
+find_library(WESTEROS_SERVER_LIB_SOC NAMES westeros_gl
+        HINTS ${PC_WESTEROS_LIBDIR} ${PC_WESTEROS_LIBRARY_DIRS}
+        )
+
+
 find_path(WESTEROS_SERVER_INCLUDE_DIRS NAMES westeros-compositor.h
         HINTS ${PC_WESTEROS_INCLUDEDIR} ${PC_WESTEROS_INCLUDE_DIRS}
         )
 
-set (WESTEROS_SERVER_LIBRARIES ${PC_WESTEROS_LIBRARIES} "${WESTEROS_SERVER_LIB_SERVER}" "${WESTEROS_SERVER_LIB_SERVER}")
+set (WESTEROS_SERVER_LIBRARIES ${PC_WESTEROS_LIBRARIES} "${WESTEROS_SERVER_LIB_SERVER}" "${WESTEROS_SERVER_LIB_SERVER}" "${WESTEROS_SERVER_LIB_SOC}")
 
 set (WESTEROS_SERVER_FOUND ${PC_WESTEROS_FOUND})
 
 message(WESTEROS_SERVER_LIB_GL)
 message(${WESTEROS_SERVER_LIB_GL})
 
-if(WESTEROS_SERVER_FOUND AND NOT TARGET WesterosServer::WesterosServer)
-    set(WESTEROS_SERVER_LIB_SERVER_LINK_LIBRARIES "${WESTEROS_SERVER_LIB}" "${WESTEROS_SERVER_LIB_GL}" "${WESTEROS_SERVER_LIB_SHELL_SERVER}" "${WESTEROS_SERVER_LIB_BUFFER_SERVER}")
-    add_library(WesterosServer::WesterosServer UNKNOWN IMPORTED)
-    set_target_properties(WesterosServer::WesterosServer PROPERTIES
-            IMPORTED_LINK_INTERFACE_LANGUAGES "C"
-            IMPORTED_LOCATION "${WESTEROS_SERVER_LIB}"
-            INTERFACE_INCLUDE_DIRECTORIES "${WESTEROS_SERVER_INCLUDE_DIRS}"
-            INTERFACE_COMPILE_OPTIONS "${WESTEROS_SERVER_CFLAGS_OTHER}"
-            INTERFACE_LINK_LIBRARIES "${WESTEROS_SERVER_LIB_SERVER_LINK_LIBRARIES}"
-            )
-endif()
+set(WESTEROS_SERVER_LIB_SERVER_LINK_LIBRARIES "${WESTEROS_SERVER_LIB}" "${WESTEROS_SERVER_LIB_GL}" "${WESTEROS_SERVER_LIB_SHELL_SERVER}" "${WESTEROS_SERVER_LIB_BUFFER_SERVER}" "${WESTEROS_SERVER_LIB_SOC}"  )
+add_library(WesterosServer::WesterosServer UNKNOWN IMPORTED)
+set_target_properties(WesterosServer::WesterosServer PROPERTIES
+        IMPORTED_LINK_INTERFACE_LANGUAGES "C"
+        IMPORTED_LOCATION "${WESTEROS_SERVER_LIB}"
+        INTERFACE_INCLUDE_DIRECTORIES "${WESTEROS_SERVER_INCLUDE_DIRS}"
+        INTERFACE_COMPILE_OPTIONS "${WESTEROS_SERVER_CFLAGS_OTHER}"
+        INTERFACE_LINK_LIBRARIES "${WESTEROS_SERVER_LIB_SERVER_LINK_LIBRARIES}"
+        )
 
 include(FindPackageHandleStandardArgs)
 FIND_PACKAGE_HANDLE_STANDARD_ARGS(PC_WESTEROS DEFAULT_MSG WESTEROS_SERVER_FOUND)
-- 
2.24.0

