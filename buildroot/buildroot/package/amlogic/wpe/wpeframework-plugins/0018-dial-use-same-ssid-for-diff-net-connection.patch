diff --git a/DIALServer/DIALServer.cpp b/DIALServer/DIALServer.cpp
index f5bd8a5..a0c0f03 100644
--- a/DIALServer/DIALServer.cpp
+++ b/DIALServer/DIALServer.cpp
@@ -363,7 +363,48 @@ namespace Plugin {
         close(sock_fd);
         return true;
     }
+    static bool get_mac(char* mac, const char *if_typ)
+	{
+	    struct ifreq tmp;
+	    int sock_mac;
+	    char mac_addr[18];
+	    sock_mac = socket(AF_INET, SOCK_STREAM, 0);
+	    if( sock_mac == -1){
+	        return false;
+	    }
+	    memset(&tmp,0,sizeof(tmp));
+	    strncpy(tmp.ifr_name, if_typ,sizeof(tmp.ifr_name)-1 );
+	    if( (ioctl( sock_mac, SIOCGIFHWADDR, &tmp)) < 0 ){
+			close(sock_mac);
+	        return false;
+	    }
+	    sprintf(mac_addr, "%02x%02x%02x%02x%02x%02x",
+	            (unsigned char)tmp.ifr_hwaddr.sa_data[0],
+	            (unsigned char)tmp.ifr_hwaddr.sa_data[1],
+	            (unsigned char)tmp.ifr_hwaddr.sa_data[2],
+	            (unsigned char)tmp.ifr_hwaddr.sa_data[3],
+	            (unsigned char)tmp.ifr_hwaddr.sa_data[4],
+	            (unsigned char)tmp.ifr_hwaddr.sa_data[5]
+	            );
+	    //printf("local mac:%s\n", mac_addr);
+	    close(sock_mac);
+	    memcpy(mac,mac_addr,strlen(mac_addr));
+	    return true;
+	}
+	static std::string getDeviceId()
+	{
+		std::string id;
+		char mac_addr[18] = "";
+		if (!get_mac(mac_addr, "eth0")) {
+			return "";
+		}
 
+		id = std::string(mac_addr);
+		if (id.length() >= 4) {
+			id = "-" + id.substr(id.length() - 4,  4);
+		}
+		return id;
+	}
     /* virtual */ const string DIALServer::Initialize(PluginHost::IShell* service)
     {
         string result;
@@ -433,8 +474,9 @@ namespace Plugin {
             if (get_mac_address(ipaddr,c_macaddr))
             {
                 MacAddress= _T(c_macaddr);
-                deviceId = deviceId+MacAddress;
-                deviceId.erase(std::remove(deviceId.begin(), deviceId.end(), ':'), deviceId.end());
+                deviceId = deviceId+getDeviceId();
+                deviceId.erase(std::remove(deviceId.begin(), deviceId.end(), '-'), deviceId.end());
+                deviceId.erase(std::remove(deviceId.begin(), deviceId.end(), '/'), deviceId.end());
             }
 			if (urlwithoutport.compare(_dialURL.Text()))
             {
